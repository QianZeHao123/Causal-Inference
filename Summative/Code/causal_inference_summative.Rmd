---
title: "Appendix for Causal Inference Summative"
author: "Z0195806"
date: "`r Sys.Date()`"
output: 
  pdf_document: 
    latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Appendix 0 Research Question

**"What is the impact of narrowly winning an election on future policy changes or reelection success?"**

# Appendix 1 Read the .dta file

Data Resource: <https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/567RS6>

## 1.1 Using haven to load the "RD_IP.dta" file

```{r}
# change to current directory
setwd(getwd())
# install.packages('haven')
library(haven)
data = read_dta("./data/RD_IP.dta")
```

## 1.2 Variable Explanation

1.  **StAlphCd** - State Alpha Code: Abbreviation of the state.
2.  **CDNumAtL** - Congressional District Number at Large.
3.  **YearElec** - Year of the Election.
4.  **Ob** - Observation number or identifier.
5.  **Use** - Indicator for whether the data row is usable for analysis.
6.  **CngrsNum** - Congress Number, indicating which session of Congress.
7.  **StICPSR** - State ICPSR Code, a unique identifier for states in political databases.
8.  **StPOAbrv** - State Postal Abbreviation.
9.  **DifDPct** - Difference in Democratic Percentage points between elections.
10. **DemPct** - Percentage of vote that went to the Democratic candidate.
11. **DemWin** - Indicator of whether the Democratic candidate won.
12. **DWinPrv** - Indicator of whether the Democrat won the previous election.
13. **DWinNxt** - Indicator of whether the Democrat won the next election.
14. **DifPVDec** - Difference in Presidential Vote share by the decade.
15. **OpenSeat** - Indicates if the election was for an open seat (no incumbent).
16. **IncStatus** - Incumbency status.
17. **PrvTrmsD** - Number of previous terms served by the Democratic candidate.
18. **PrvTrmsO** - Number of previous terms served by the opposing candidate.
19. **VoteTotW** - Total votes for the winning candidate.
20. **VoteTotL** - Total votes for the losing candidate.
21. **VoteCast** - Total votes cast in the election.
22. **SoSDem** - Secretary of State is a Democrat (indicator).
23. **PrvElcOb** - Observation number of the previous election.
24. **NxtElcOb** - Observation number of the next election.
25. **DemInc** - Indicates if the incumbent is a Democrat.
26. **DemOpen** - Indicates if the open seat was previously held by a Democrat.
27. **NonDInc** - Indicates if the incumbent is not a Democrat.
28. **NonDOpen** - Indicates if the open seat was previously held by a non-Democrat.
29. **DExpAdv** - Democratic Experience Advantage.
30. **RExpAdv** - Republican Experience Advantage.
31. **ForgnPct** - Percentage of foreign-born population in the district.
32. **GovWkPct** - Percentage of government workers in the district.
33. **BlackPct** - Percentage of African American population in the district.
34. **UrbanPct** - Percentage of urban population in the district.
35. **VtTotPct** - Voter turnout percentage.
36. **DPctNxt** - Democratic vote percentage in the next election.
37. **DifDPNxt** - Difference in Democratic Percentage in the next election.
38. **DPctPrv** - Democratic vote percentage in the previous election.
39. **DifDPPrv** - Difference in Democratic Percentage in the previous election.
40. **ElcSwing** - Electoral swing.
41. **GovDem** - Indicates if the governor is a Democrat.
42. **IncDWNOM1** - NOMINATE score of the incumbent Democrat.
43. **DSpndPct** - Percentage of campaign spending by the Democrat.
44. **DDonaPct** - Percentage of donations received by the Democrat.
45. **CQRating3** - Congressional Quarterly rating for the district.
46. **DifIPPct** - Difference in Incumbent Party Percentage points.
47. **IPwin** - Incumbent Party win indicator.
48. **close05** - Close election indicator based on a margin of 0.5%.
49. **IPPctNxt** - Incumbent Party percentage in the next election.
50. **IPPctPrv** - Incumbent Party percentage in the previous election.
51. **DifIPPPrv** - Difference in Incumbent Party Percentage in the previous election.
52. **IPInc** - Incumbent Party Incumbency.
53. **PrvTrmsIP** - Previous Terms of Incumbent Party.
54. **IPExpAdv** - Incumbent Party Experience Advantage.
55. **IPSwing** - Incumbent Party Swing.
56. **CQRatingIP** - Congressional Quarterly rating based on Incumbent Party.
57. **IPSpndPct** - Incumbent Party Spending Percentage.
58. **IPDonaPct** - Incumbent Party Donation Percentage.
59. **SoSIP** - Secretary of State from Incumbent Party.
60. **GovIP** - Indicates if the governor is from the incumbent party.
61. **DifPVIP** - Difference in Presidential Vote share attributed to the incumbent party, averaged over the decade.

```{r}
write.csv(data, "./data/RD_IP.csv", row.names = FALSE)
```

# Appendix 2 Exploratory Data Analysis

## 2.1 **Load Required Libraries**

```{r message=FALSE, warning=FALSE}
# Load necessary libraries from tidyverse individually
# For creating visualizations
# For data manipulation
library(dplyr)
# # For reading CSV data
# library(readr)
# For data tidying
library(tidyr)
# # For functional programming tools
# library(purrr)
# # For categorical variable handling
# library(forcats)
# # For date-time manipulation, useful in time series analysis
# library(lubridate)

# Libraries for causal inference
# For regression discontinuity designs
library(rdd)
# For difference-in-differences analysis with multiple groups and time periods
library(DIDmultiplegt)
# For synthetic control method
library(Synth)
```

## 2.2 **Inspect the Dataset**

```{r}
# View the first few rows of the dataset
# head(data)
# Get a summary of the dataset
# summary(data)
# Check the structure of the dataset
# str(data)
```

## 2.3 **Initial Exploratory Data Analysis**

```{r message=FALSE, warning=FALSE}
# Plotting histograms for continuous variables
# such as vote percentages and differences
library(ggplot2)
rd %>% 
  select(DifDPct, DemPct, IPPctPrv, VoteTotW, VoteTotL) %>% 
  gather(key = "variable", value = "value") %>% 
  ggplot(aes(x = value)) +
  geom_histogram(bins = 30, fill = "blue", alpha = 0.7) +
  facet_wrap(~variable, scales = "free_x")
```

```{r message=FALSE, warning=FALSE}
# Box plots for comparing incumbent vs. non-incumbent vote totals
rd %>%
  ggplot(aes(
    x = factor(IPwin),
    y = VoteTotW,
    fill = factor(IPwin)
  )) +
  geom_boxplot() +
  labs(x = "Incumbent Won",
       y = "Vote Total for Winner",
       title = "Distribution of Vote Totals by Incumbency")
```

```{r fig.height=8.5, fig.width=6, message=FALSE, warning=FALSE}
# Checking for missing values visually
rd %>% 
  summarise_all(funs(sum(is.na(.)))) %>%
  gather(key = "variable", value = "n_missing") %>%
  ggplot(aes(x = variable, y = n_missing)) +
  geom_col() +
  coord_flip() +
  labs(x = "Variable",
       y = "Number of Missing Values",
       title = "Missing Data in Each Variable")
```

# Appendix 3 **Regression Discontinuity Design**

```{r}
data.rdd = data %>%
  select(CDNumAtL, YearElec, DemPct, VoteTotW, close05) %>%
  mutate(close05 = if_else(is.na(close05), 0, close05)) %>%
  drop_na() %>%
  mutate(treatment = if_else(DemPct > 50, 1, 0))
```

```{r}
# Check the data after adjustment
# glimpse(data.rdd)
```

```{r}
# Re-plot to visualize the potential discontinuity
# at the cutoff with adjusted data
ggplot(data.rdd, aes(
  x = DemPct,
  y = VoteTotW,
  color = as.factor(treatment)
)) +
  geom_point(alpha = 0.5) +
  geom_vline(xintercept = 50,
             linetype = "dashed",
             color = "red") +
  labs(title = "Vote Totals of Democratic Vote Percentage",
       subtitle = "Red line represents the cutoff at 50%",
       color = "Treatment Status")
```

```{r message=FALSE, warning=FALSE}
library(rddtools)
```

# Appendix 4 **Difference in Differences**

# Appendix 5 Synthetic Control
